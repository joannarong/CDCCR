---
title: "STAD97PROJECT"
author: "Joanna(Yijing) Rong"
date: "July 22, 2016"
output: html_document
---
Appendix - Data Organization
```{r}
#'Turn list of co/chronic mobidity and mental health into "ture" and "false"
#'
#' @param x the levels for patients in the original data frame to be turned into "ture" and "false"
#' @param possible numbers of possible levels for co/chronic mobidity and mental health
#' @return vectors of "ture" and "false" according to the levels of co/chronic mobidity and mental health
extractmorbidity=function(x,possible) #possible=#of possible values for 16 or 23 values for chronic / co-mobidity
{
  if(x[1]==999||is.na(x[1]))
  {
    return(rep(F,possible))
  }else{
    has=rep(F,possible)
    for(i in x){
      has[i]=T
    }
    return(has)
  }
}

hasrepeat=function(x,possible)
{
  tab=table(x)
  m=max(tab)
  w=names(which.max(tab))
  ifelse(m>1,w,NA)
}

#x=c(2,3,2,3,4)
#table(x)
#tab=table(t(data2[2,14:23]))
#tab["23"]

#'built a function that will count numbers of 23(mental health in comorbidity) in one patient
count23=function(x)
{
  tab=table(t(x))
  ans=ifelse(is.na(tab["23"]),0,tab["23"])
}

#count.discharged.status=function(x)
#{
  #tab=table(t(x))
  #ans=ifelse(is.na(tab["2"]),0,tab["2"])
#}

#'built a function that count the total numbers of actual mental health issue for each patient 
countmh=function(x)
{
  return(sum(table(t(x))))
}



#made fuction that label the specific values of each co-mobidity
extractco=function(x)
{
  thenames=c("Other","Eating Disorders","Hypertension","Cardiovascular disease","Chronic kidney disease",
             "Retinopathy or Other eye disease"," Non-healing wounds (greater than 3 months)","Neuropathy","Liver disease (fatty liver)",
             "Peripheral vascular disease","Obesity (BMI > 30)","Current malignancy/cancer treatment","Hyperlipidemia",
             "Thyroid disease (other endocrinopathies POCT, Cushings)","Dementia","Pulmonary disease (COPD, Asthma)","Obstructive sleep apnea",
             "HIV/AIDS","Pancreas Diseases","Celiac Disease","Genetic Syndromes","Deafness and/or Blindness","Mental health") 
  M=extractmorbidity(x,23)
  names(M)=thenames
  return(M)
  
}

#made functionthat label the specific values for each chronic-morbidity
extractchronic=function(x)
{
  thenames=c("Other(Chronic)","Neuropathy","Retinopathy","Blindness","Cardiovascular disease(Chronic)","Wounds (non-healing)",
             "Amputation","Skin conditions (cutaneous manifestations)","Lipohypertrophy","Hypoglycemia unawareness",
             "Diabetic myonecrosis","Foot problems (Charcot’s)","Stiff man’s syndrome","Hearing impairment","Fractures","Nephropathy")
  M=extractmorbidity(x,16)
  names(M)=thenames
  return(M)
}

extractMH=function(x)
{
  thenames=c("Depressive Disorder","Obsessive-compulsive and related disorders","Schizophrenia spectrum and other psychotic disorders",
             "Substance-related and addictive disorders","Bipolar Disorders","Anxiety disorders",
             "Neurodevelopmental disorder","Trauma and Stress-related disorders","Personality Disorders","Feeding and Eating Disorders",
             "Sleep-wake disorders","Type Unspecified")
  
  possible=12
  if(is.na(x[1]))
  {
    y=rep(F,possible)
  }else{
    has=rep(F,possible)
    for(i in x){
      if(!is.na(i)){
        has[i]=T
      }
    }
    y=has
  }
  names(y)=thenames
  return(y)
}



#'function that capture non numeric values
TidyDDScode=function(x){
  y=as.character(x)
  z=as.numeric(y)
  code=ifelse(is.na(z),y,ifelse(z<20,"numeric",y))
  return(code)
}

#'function that capture numeric values that are below 20
TidyDDSnumbers=function(x){
  y=as.character(x)
  z=as.numeric(y)
  code=ifelse(is.na(z),NA,ifelse(z<20,z,NA))
  return(code)
}


# read data in from csv
# 
# a paragraph with more details about function
# 
# @param file.name name of imported file
#
# @return dataframe containing all variables as appropriatly dates, factor and logicals
# @export 
# @import dplyr
# @import lubridate
library(dplyr)
Readdata=function(file.name)
{
  data=read.csv("inst/extdata/20160715.csv",header=T)
  #refer the column names by numbers
  
  #take the rows that are not NA for location and gender
  #cut = converted the numbers into factors --> converted the numbers to factors of the following variables
  #library(dplyr)
  data %>%
    dplyr::slice(1:622) ->data2
  
  
  locationf=cut(data2[,2],breaks=c(0,1.2,3),labels=c("HALTON","MISSISSAUGA"))
  
  
  genderf=cut(data2[,4],breaks=c(0,1.5,3),labels=c("M","F"))
  
  agef=cut(data2[,3],breaks=c(17,45,65,80,95))
  
  repeatreferral=cut(data2[,7],breaks=c(-1,0.5,2),labels=c("No","Yes"))
  
  
  referralfrom=cut(data2[,8],breaks=c(-1,1.5,2.5,3.5,4.5,6),labels=c("primary","self","specialist","hospital","DEC"))
  
  
  socialissue=cut(data2[,9],breaks=c(0,1.5,2.5,3.5,4.5,5.5,6.5,7.5,8.5,9.5,11,1000),
                  labels=c("social","community","income","elderly","smoke","drugs","housing","mobility","language","education","none"))
  #consider changing the short names to the actual names  
  
  profcareplan=cut(data2[,64],breaks=c(-1,0.5,2,1000),labels=c("No","Yes","N/A"))
  
  
  SelfMGoals=cut(data2[,65],breaks=c(-1,0.5,2,1000),labels=c("No","Yes","N/A"))
  
  
  ExtentSelfM=cut(data2[,66],breaks=c(-1,0.5,1.5,2.5,3.5,1000),labels=c("None","Some","Most","All","N/A"))
  
  
  Pdischwithtrans=cut(data2[,67],breaks=c(-1,0.5,2,1000),labels=c("No","Yes","N/A"))
  
  
  DischSt=cut(data2[,69],breaks=c(0,1.5,2.5,3.5),labels=c("withdrawal","discharged","death"))
  
  
  Endorefer=cut(data2[,87],breaks=c(-1,0.5,2),labels=c("no","yes"))
  
  
  #extract the dates and truned them into Rdate
  #obtain different duration between admit date and discharge date
  
  #library(lubridate)
  referdate=lubridate::dmy(data2[,6])
  
  
  admitdate=lubridate::dmy(data2[,34])
  
  
  dischargedate=lubridate::dmy(data2[,68])
  
  
  
  #dis - data2[,73] #column 73 is numbers of weeeks between admitdate and discharge date as calculated in spreadsheet
  #summary(as.numeric(dis) - data2[,73])  #checking if the calculation is consisting
  #column Bu- Time in CCDC doesn't appear in the final spread sheet
  
  #co-mo is from column 14-23
  #chronic comlication is from column 24-33
  
  #made the function for "T=pts has both morbidity and F=pts doesn't have morbidity"
  
  
  como=t(apply(data2[,14:23],1,extractco))
  comorep=apply(data2[,14:23],1,hasrepeat)
  comorep
  which(comorep=="3")
  comomhrep=apply(data2[,14:23],1,count23)
  comomhrep #'counted numbers of "23" for each patient among the comorbidity columns --> fixed: no patients has repeated 23 any more!
  
  which(comomhrep>1) #' no patients are found that has more than one 23
  actualmhrep=apply(data2[,74:78],1,countmh)
  actualmhrep #'counted numbers of actual mental health issue for each patient among the mental health sections
  table(comomhrep>=1,actualmhrep>=1)
  which(comomhrep>=1 & actualmhrep==0) # not an issue any more--> pt354 doesn't have any mental healthy diagnosis listed, but has 23 coded in the comorbidity section 
  
  table(comorep) #show which coded comorbidity has repeates --> only code "1" is repeated, but agree on ignoring it (also row61 has more 22 twice, but it's all good! )
  which(!is.na(comorep)) #shows which patients has more than one unique code
  #only co-morbidity has a lot of repeats 
  
  chronic=t(apply(data2[,24:33],1,extractchronic))
  chronicrep=apply(data2[,24:33],1,hasrepeat)
  chronicrep
  table(chronicrep)
  #no repeats are found in chronic complications
  
  MH=t(apply(data2[,74:78],1,extractMH))
  head(MH)
  MHrep=apply(data2[,74:78],1,hasrepeat)
  MHrep
  table(MHrep)
  #no repeats found for MH diagnosis 
  
  
  #make a new dataframe 
  como=as.data.frame(como)
  chronic=as.data.frame(chronic)
  MH=as.data.frame(MH)
  dataframe=data.frame(locationf,age=data2[,3],genderf,agef,distance=data2[,5],referdate,repeatreferral,referralfrom,socialissue,
                       DDS.Emotional.burden.Enrollment=TidyDDSnumbers(data2[,10]),DDS.Emotional.burden.Enrollment.code=TidyDDScode(data2[,10]),
                       DDS.Physician.related.distress.Enrollment=TidyDDSnumbers(data2[,11]),DDS.Physician.related.distress.Enrollment.code=TidyDDScode(data2[,11]),
                       DDS.Regimen.related.distress.Enrollment=TidyDDSnumbers(data2[,12]),DDS.Regimen.related.distress.Enrollment.code=TidyDDScode(data2[,12]),
                       DDS.Interpersonal.distress.Enrollment=TidyDDSnumbers(data2[,13]),DDS.Interpersonal.distress.Enrollment.code=TidyDDScode(data2[,13]),
                       como,chronic,admitdate,data2[,35:39],admit.waist=as.numeric(as.character(data2[,40])),data2[,41:49],
                       DCweight=as.numeric(as.character(data2[,50])),
                       data2[,51:58],
                       DDS.Emotional.burden.Discharge=TidyDDSnumbers(data2[,59]),DDS.Emotional.burden.Discharge.code=TidyDDScode(data2[,59]),
                       DDS.Physician.related.distress.Discharge=TidyDDSnumbers(data2[,60]),DDS.Physician.related.distress.Discharge.code=TidyDDScode(data2[,60]),
                       DDS.Regimen.related.distress.Discharge=TidyDDSnumbers(data2[,61]),DDS.Regimen.related.distress.Discharge.code=TidyDDScode(data2[,61]),
                       DDS.Interpersonal.distress.Discharge=TidyDDSnumbers(data2[,62]),DDS.Interpersonal.distress.Discharge.code=TidyDDScode(data2[,62]),
                       data2[,63],profcareplan,
                       SelfMGoals,ExtentSelfM,Pdischwithtrans,dischargedate,DischSt,data2[,70:73],MH,data2[,79:86],Endorefer)
  return(dataframe)
}

dataframe=Readdata()
head(dataframe)
```


















Data Analysis
1a.Numbers of male and female patients from each site
```{r}
outofregions <- table(dataframe$locationf,dataframe$genderf)
outofregions
prop.table(outofregions,margin=1)
```
No effect of genders - same percentage of males and females from both regions

```{r}
boxplot(dataframe$age~dataframe$locationf)
```
Boxplot analysis suggest that there are no great difference in midian and spread for numbers of patients on both sites.

```{r}
boxplot(dataframe$distance~dataframe$locationf)
```
The median distance to both sites are very similarl; more poeple who need to travel longer distance tend to visit Mississauga site.


1b.numbers of patients with each social issue/range of social issues:
```{r}
socialissues <- table(dataframe$socialissue)
socialissues
plot(dataframe$socialissue,las=2)
```
Compare to the impactful issues you mentioned, the following social issues appears to be more frequent: low income, social support, smoking, elderly 

```{r}
names(dataframe)
```


1c.numbers of patients with each co-morbidity
```{r}
avgcomo=subset(dataframe, select=c("Other","Eating.Disorders","Hypertension","Cardiovascular.disease","Chronic.kidney.disease","Retinopathy.or.Other.eye.disease","X.Non.healing.wounds..greater.than.3.months.",
                          "Neuropathy","Liver.disease..fatty.liver.","Peripheral.vascular.disease","Obesity..BMI...30.","Current.malignancy.cancer.treatment","Hyperlipidemia","Thyroid.disease..other.endocrinopathies.POCT..Cushings.","Dementia",
                             "Pulmonary.disease..COPD..Asthma.","Obstructive.sleep.apnea","HIV.AIDS","Pancreas.Diseases","Celiac.Disease","Genetic.Syndromes","Deafness.and.or.Blindness","Mental.health"))
avgcomo

library(tidyr)
library(dplyr)
avgcomo %>% gather(col,v,Other:Mental.health) %>% table()
```
Provide information about distribution of co-morbidity among patients; The co-morbidities with the highest frequency:Cardiovascular.disease



1c.average # of co-morbidities
```{r}
sumofcomofoeachpt=apply(avgcomo,1,sum)
summary(sumofcomofoeachpt) 
```
Each patients have average of 3 different co-morbidity



1c.numbers of patients with each chronic-morbidity 
```{r,w}
b=subset(dataframe, select=c("Other.Chronic.","Neuropathy.1","Retinopathy","Blindness","Cardiovascular.disease.Chronic.","Wounds..non.healing.",
                             "Amputation","Skin.conditions..cutaneous.manifestations.","Lipohypertrophy","Hypoglycemia.unawareness",
                             "Diabetic.myonecrosis","Foot.problems..Charcot.s.","Stiff.man.s.syndrome","Hearing.impairment","Fractures","Nephropathy"))
b
b %>% gather(col,v,Other.Chronic.:Nephropathy) %>% table()
```
Highest frequency among chronic-morbidity:Neuropathy (155)



1c.average # of chronic-morbidities
```{r}
sumofchronicfoeachpt=apply(b,1,sum) 
summary(sumofchronicfoeachpt) 
```
Each pt have average 1 chronic-morbidity



1c.numbers of patients have mental health as co-morbidity:
```{r}
comomental <- table(dataframe$Mental.health)
comomental
which(dataframe$Mental)
```
186 patients have mental health as one of their co-morbidity
also provides informaiton about who are those patients

How many has mental health as one of the co-morbidities(regardingprotions of F and M)
```{r}
comomental <- table(dataframe$Mental.health,dataframe$genderf)
comomental
prop.table(comomental,margin=2)
```
Among Male, only 25% have mental health issues, but higher proportion of female than male have mental health issue 




2a.comparing admit and discharged clinical metrics (A1C)
```{r}
library(dplyr)
library(tidyr)
library(ggplot2)

dataframe %>% gather(admitdischarge,A1C,c(admit.A1C,D.C.A1C)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+"))) %>% 
  ggplot(aes(x=genderf,y=A1C))+geom_boxplot()+facet_grid(admitdischarge~agef)

```
-discharged A1C values are substentically lower across all age groups than admit A1C level 
-Older patients tend to have lower admit and discharged A1C value compare to younger patients in general
-not much genders effects as the changes of A1C values in males are similar as females
-A1C values appears to decrease as age increase for both adimit and discharge 

```{r}
dataframe %>% gather(admitdischarge,A1C,c(admit.A1C,D.C.A1C)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+"))) %>% group_by(agef,genderf) %>% 
  summarise(n=n())
```
This provides information about numbers of patients in each category to ensure that there are sufficient numbers of individual in each group to prevent bias. There are resonably large frequency for each age group - good thing


```{r}
dataframe %>% gather(admitdischarge,A1C,c(admit.A1C,D.C.A1C)) %>% 
  filter(is.na(A1C)) %>% select(c(admitdischarge,A1C)) 

c=subset(dataframe, select=c("admit.A1C","D.C.A1C","DischSt"))
c
c %>% gather(admitdischarge,A1C,c(admit.A1C,D.C.A1C)) %>% filter(is.na(A1C))
```
Keep in mind that there are 97 missing A1C values in total (2 are from admited A1C); but all patients who have missing D.C.A1C are actually withdrew becuase of death/withdrawal, no missing data are found among those who discharged --> nothing to worry about!


2a.comparing admit and discharged clinical matrix(Lipids level(HDL cholesterol))
```{r}
dataframe %>% gather(admitdischarge,LipidHDL,c(admit.HDL.Cholesterol, D.C.HDL.Cholesterol)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+")))->mutatea
  mutatea %>% ggplot(aes(x=genderf,y=LipidHDL))+geom_boxplot()+facet_grid(agef~admitdischarge) 

```
female have higher HDL lipid level in general regardless of treatment, age.
distribution of male are typically between 0.9 to 1.3; and distrubution of female is about 1 to 1.4 - there is only gender effect as female are consistently higher, but it's consistent between admit and discharged HDL cholesterol level = treatment doesn't seem to have effect as the changes are very small.

added filter to select HDLlevel less than 3
```{r}
mutatea %>% filter(LipidHDL<3) %>% 
  ggplot(aes(x=genderf,y=LipidHDL))+geom_boxplot()+facet_grid(agef~admitdischarge)
```

summary of the data
```{r}
mutatea %>% group_by(admitdischarge,agef,genderf) %>% summarise(Q1=quantile(LipidHDL,0.25,na.rm=T),
    med=median(LipidHDL,na.rm=T),Q3=quantile(LipidHDL,0.75,na.rm=T),missing=sum(is.na(LipidHDL)),n=n())
```

analysis of variance - pending
```{r}
mutatea
```





2a.comparing admit and discharged clinical matrix(Lipids level(LDL cholesterol))
```{r}
aggregate(cbind(admit.LDL.Cholesterol, D.C.LDL.Cholesterol)~genderf+agef,data=dataframe,mean)

dataframe %>% gather(admitdischarge,LipidLDL,c(admit.LDL.Cholesterol, D.C.LDL.Cholesterol)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+"))) %>% 
  ggplot(aes(x=genderf,y=LipidLDL))+geom_boxplot()+facet_grid(agef~admitdischarge)
```

The median of both admit and discharged LDL cholesterol level appear to be very similar, suggesting very minor treatment effect on this clinical matrix


2a.comparing admit and discharged clinical matrix(eGFR)
```{r}
aggregate(cbind(admit.eGFR, D.C.eGFR)~genderf+agef,data=dataframe,mean)

dataframe %>% gather(admitdischarge,eGFR,c(admit.eGFR, D.C.eGFR)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+")))->mutatea
  mutatea %>% ggplot(aes(x=genderf,y=eGFR))+geom_boxplot()+facet_grid(agef~admitdischarge)
```
-eGFR scores then to be lower as age increase 
-median of discharged eGFR value decrease substentically for male in age group 18-44

numerical summary of the data
```{r}
mutatea %>% group_by(admitdischarge,agef,genderf) %>% summarise(Q1=quantile(eGFR,0.25,na.rm=T),
    med=median(eGFR,na.rm=T),Q3=quantile(eGFR,0.75,na.rm=T),missing=sum(is.na(eGFR)),n=n())
```
the treatment effect appears to be samll/non existent as the difference between admit and discharge across gender and age is consistent; however, there is age effect as as age increase, eGFR value decrease (At least for the first 3 age groups). there is no consistent gender effect. 

2a.comparing admit and discharged clinical matrix(Micro Albumin)
```{r}
aggregate(cbind(admit.Micro.Albumin,D.C.Micro.Albumin)~genderf+agef,data=dataframe,mean)

dataframe %>% gather(admitdischarge,Microalbumin,c(admit.Micro.Albumin, D.C.Micro.Albumin)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+"))) %>% 
  ggplot(aes(x=genderf,y=Microalbumin))+geom_boxplot()+facet_grid(agef~admitdischarge)
```
need help



2c.Change in QoL index (emotional burden)
```{r}
dataframe %>% gather(admitdischarge,emotionalBurden,c(DDS.Emotional.burden.Enrollment,DDS.Emotional.burden.Discharge)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+"))) %>% 
  ggplot(aes(x=genderf,y=emotionalBurden))+geom_boxplot()+facet_grid(agef~admitdischarge)
```
-lower emotional burden discharge scores for both male and female
-female tend to have higher emotional burden discharge scores than male for both admit and discharged measuremnt (except for female in age group 18-44 )
-the older the patients, the lower the emotional burden scores are measured

```{r}
dataframe %>% gather(admitdischarge,emotionalBurden,c(DDS.Emotional.burden.Enrollment,DDS.Emotional.burden.Discharge)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+"))) %>% group_by(agef,genderf) %>% 
  summarise(n=n())
```
This provides information about numbers of patients in each category to ensure that there are sufficient numbers of individual in each group to prevent bias. There are resonably large frequency for each age group - good thing


```{r}
dataframe %>% gather(admitdischarge,emotionalBurden,c(DDS.Emotional.burden.Enrollment,DDS.Emotional.burden.Discharge)) %>% 
  ggplot(aes(x=age,y=emotionalBurden))+geom_point()+facet_grid(genderf~admitdischarge)

```
also explore how the data look like in scatterplot :scatterplot of emotional burden by age - numeric and classify by admit/discharged by genders



2c.Change in QoL index (physician related distress)
```{r}
dataframe %>% mutate(id=row_number()) %>% 
  gather(admitdischarge,physicianRelated,c(DDS.Physician.related.distress.Enrollment,DDS.Physician.related.distress.Discharge)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+")))->mutatea 
  mutatea %>% ggplot(aes(x=genderf,y=physicianRelated))+geom_boxplot()+facet_grid(agef~admitdischarge)

```

spaghetti plot
```{r}
mutatea %>% ggplot(aes(x=admitdischarge,y=physicianRelated,group=id,color=factor(id))) + geom_point() + geom_line() + facet_grid(agef~genderf)+guides(color=F)
```
this plot shows treatment effects as most of the lines go down 

2c.Change in QoL index (Regimen related distress)
```{r}
dataframe %>% gather(admitdischarge,RegimenRelated,c(DDS.Regimen.related.distress.Enrollment,DDS.Regimen.related.distress.Discharge)) %>% mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+"))) %>% ggplot(aes(x=genderf,y=RegimenRelated))+geom_boxplot()+facet_grid(agef~admitdischarge)
```
-Both female and male patients across all age groups displace substentically lower discharged Regimen related distress score! 
-among them, both male and female patients in age group 80+ have the lowest admit and discharged Regimen related distress score
-no gender effects are observed since the changes in admit and discharged scores are similar for both male and female


2c.Change in QoL index (Interpersonal distress)
```{r}
dataframe %>% gather(admitdischarge,interpersonalDistress,c(DDS.Interpersonal.distress.Enrollment,DDS.Interpersonal.distress.Discharge)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80+"))) %>% 
  ggplot(aes(x=genderf,y=interpersonalDistress))+geom_boxplot()+facet_grid(agef~admitdischarge)
```
-similarly, both female and male patients across all age groups displace substentically lower interpersonal distress score.
-both male and female patients in age group 80+ have the lowest admit and discharged interpersonal distress score
-leave the outlier 


spaagetti plot for the data 
```{r}
dataframe %>% mutate(id=row_number()) %>% gather(admitdischarge,interpersonalDistress,c(DDS.Interpersonal.distress.Enrollment,DDS.Interpersonal.distress.Discharge)) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),
                  labels=c("18-44","45-64","65-79","80")))->mutatea
  mutatea %>% ggplot(aes(x=genderf,y=interpersonalDistress))+geom_boxplot()+facet_grid(agef~admitdischarge)
  
  mutatea %>% ggplot(aes(x=admitdischarge,y=interpersonalDistress,group=id,color=factor(id)))+geom_point()+geom_line()+facet_grid(agef~genderf)+guides(color=F)
```
show treatment effect - line goes down 

numeric summary
```{r}
mutatea %>% group_by(genderf,agef,admitdischarge) %>% summarise(Q1=quantile(interpersonalDistress,0.25,na.rm=T),
    med=median(interpersonalDistress,na.rm=T),Q3=quantile(interpersonalDistress,0.75,na.rm=T),missing=sum(is.na(interpersonalDistress)),n=n())
```
show often a big treatment effect 



2d. Change in clinical metrics(A1C) for subgroups: mental health patients
```{r}
dataframe %>% gather(admitdischarge,A1C,c(admit.A1C,D.C.A1C)) %>% 
  ggplot(aes(x=genderf,y=A1C))+geom_boxplot()+facet_grid(Mental.health~admitdischarge)
```
-Discharged A1C levels are substantially lower than admit A1C level for both group of patients with/without mental health diagnosis. suggesting that there is a treatment effct due to lower dischagred A1C level, 
-however, gender and mental health does not have any effect on the scores


2d. Change in clinical metrics(Lipids level(HDL cholesterol)) for subgroups: mental health patients
```{r}
dataframe$Mental.health
aggregate(cbind(admit.HDL.Cholesterol, D.C.HDL.Cholesterol)~Mental.health,data=dataframe,mean)
```



2d. Change in clinical metrics(Lipids level(HDL cholesterol)) for subgroups: mental health patients
```{r}
dataframe$Mental.health
aggregate(cbind(admit.HDL.Cholesterol, D.C.HDL.Cholesterol)~Mental.health,data=dataframe,mean)


#'with outliers
dataframe %>% gather(admitdischarge,HDL.cholestrol,c(admit.HDL.Cholesterol, D.C.HDL.Cholesterol)) %>% 
  ggplot(aes(x=genderf,y=HDL.cholestrol))+geom_boxplot()+facet_grid(Mental.health~admitdischarge)

#'without outliers --> make it easier to compare the median
dataframe %>% gather(admitdischarge,HDL.cholestrol,c(admit.HDL.Cholesterol, D.C.HDL.Cholesterol)) %>%
  filter(HDL.cholestrol<5) %>% 
  ggplot(aes(x=genderf,y=HDL.cholestrol))+geom_boxplot()+facet_grid(Mental.health~admitdischarge)
```
Changes in HLD.cholesterol level seems to be quite similar for both group of patients, which might suggest that treatment have not much effect on patient's HDL.cholesterol level




2d. Change in clinical metrics(Lipids level(LDL cholesterol)) for subgroups: mental health patients
```{r}
dataframe %>% gather(admitdischarge,LDL.cholestrol,c(admit.LDL.Cholesterol, D.C.LDL.Cholesterol)) %>% 
  ggplot(aes(x=genderf,y=LDL.cholestrol))+geom_boxplot()+facet_grid(Mental.health~admitdischarge)

```
Mental health doesn't seem to have an effect in the changes of LDL cholesterol level: this is because the admit LDL cholesterol for borth male and female without mental health diagnosis decrease about the same ratio as those with mental health diagnosis
However, treatment seem to have bigger effect for male pt than female pt as male pt have substantial lower discharged LDL lipid level than female.


2d. Change in clinical metrics(eGFR) for subgroups: mental health patients
```{r}
dataframe$Mental.health
aggregate(cbind(admit.eGFR, D.C.eGFR)~Mental.health,data=dataframe,mean)

dataframe %>% gather(admitdischarge,eGFR,c(admit.eGFR, D.C.eGFR)) %>% 
  ggplot(aes(x=genderf,y=eGFR))+geom_boxplot()+facet_grid(Mental.health~admitdischarge)
```
Mental health might be related to higher eGFR score: both male and female with mental health diagnosis have higher eFGR scores than those who are not diagnosed with mental health.However, the treatment does not seem to improve the score as we see that discharged eGFR remain about the same as admited eGFR for both genders with/without mental health diagnosis.



2d. Change in clinical metrics(micro albumin) for subgroups: mental health patients
```{r}
dataframe %>% gather(admitdischarge,micro.albumin,c(admit.Micro.Albumin, D.C.Micro.Albumin)) %>% 
  ggplot(aes(x=genderf,y=micro.albumin))+geom_boxplot()+facet_grid(Mental.health~admitdischarge)
```
many outliers shown

numerical summary wwithout difference
```{r}
dataframe %>% gather(admitdischarge,micro.albumin,c(admit.Micro.Albumin, D.C.Micro.Albumin)) %>% group_by(genderf,agef,admitdischarge,Mental.health) %>% summarise(Q1=quantile(micro.albumin,0.25,na.rm=T),
    med=median(micro.albumin,na.rm=T),Q3=quantile(micro.albumin,0.75,na.rm=T),missing=sum(is.na(micro.albumin)),n=n()) %>% as.data.frame()

```



numerical summary - with difference (discharge-admit)
```{r}
dataframe %>% mutate(diff=D.C.Micro.Albumin-admit.Micro.Albumin) %>% 
  mutate(agef=cut(age,breaks=c(17,44,64,79,95),labels=c("18-44","45-64","65-79","80")))->mutatea

mutatea %>% group_by(genderf,agef,Mental.health) %>% summarise(Q1=quantile(diff,0.25,na.rm=T),
    med=median(diff,na.rm=T),Q3=quantile(diff,0.75,na.rm=T),missing=sum(is.na(diff)),n=n()) %>% as.data.frame()
```














